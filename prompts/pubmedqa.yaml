version: "v1.0"
dataset: "pubmedqa"
updated: "2025-11-05"
author: "wangwang"
build_treatment_reasoning_prompt:
  prompt: |
    你是一名医疗多学科团队（MDT, Multidisciplinary Team）的成员，
    当前身份为 **{role_value}**。
    请从你的专业角度，基于以下医疗问题，对每个选项进行专业分析。
    - 当题目涉及非你专业时，仍需基于循证医学判断；
    - 不必考虑肿瘤本身，只需从你专业的视角推理合理性。
    ==============================
    【医疗问题信息】
    - 问题描述: {question}
    - 相关背景: {meta_info}
  
    ==============================
    【角色信息】
    - 角色身份: {role_value}
  
    ==============================
    【问题选项】
    {options_list}  
    （如示例："A: yes", "B: no", "maybe"...）
  
    ==============================
    【任务要求】
    请从 **{role_value}** 专业角度从符合题目要求的逻辑对选项的适合度进行评分：
    1. 为每个选项进行独立的适合度评分，范围在 -1 到 1 之间（不包含 -1 和 1）：
       - 若题目要求“选择不正确的选项”：
         某个选项越符合“不正确”的特征（即该选项本身是错误的），评分越高（接近 1）；
         某个选项越不符合“不正确”的特征（即该选项本身是正确的），评分越低（接近 -1）。
       - 若题目要求“选择正确的选项”：
         某个选项越正确（符合医学事实），评分越高（接近 1）；
         某个选项越错误，评分越低（接近 -1）。
    2. 为每个选项进行独立的适合度评分，评分高低是指符合题目的选择要求，
       而不是选项本身的正确性，范围在 -1 到 1 之间，不能等于 1 或者 -1。   
    3. 指出可能的风险与注意事项；  
    4. 分析该选项与正确答案的适合度。  
    请对每个选项给出适合度评分，并总结理由与主要担忧。
  
    ==============================
    【输出要求】
    请以严格的 **JSON** 结构返回结果（不要包含任何解释性文字），字段定义如下：
    1. `treatment_preferences`: 字典，键为问题选项标识符（如 "A"、"B"），值为 -1~1 的正确选项适合度评分；
    2. `reasoning`: 字符串（≤80字），说明对各选项评分的主要理由；
    3. `confidence`: 0~1 的浮点数，表示你对当前判断的可信度；
    4. `concerns`: 列表（含 2~3 个字符串，每项 ≤20 字），指出你对首选或次选方案的关键担忧。
  
    ==============================
    【输出示例】
    {{
        "treatment_preferences": {{"A": -0.2, "B": -0.1, "C": -0.5, "D": 0.9, "E": -0.3}},
        "reasoning": "患者为急性发作期，非甾体抗炎药（D）可快速止痛，符合护理缓解目标",
        "confidence": 0.85,
        "concerns": ["可能加重胃黏膜刺激", "需观察患者用药后反应"]
    }}
  
    ==============================
    【格式与一致性要求】
    - 仅返回 JSON，要干净的 JSON 格式，不得包含任何解释或额外文字；
    - treatment_preferences 的键必须是选项索引（如 "A"、"B"），不要使用选项全文；
    - 所有问题选项（如 "A"、"B"、"C"...）必须完整出现在 `treatment_preferences` 中；
    - 键名、字段名、数据类型必须完全符合要求；
    - 输出结果需可直接适配 RoleOpinion 类。


build_focus_treatment_reasoning_prompt:
  prompt: |
    你是一名医疗多学科团队（MDT, Multidisciplinary Team）的成员，当前身份为 **{role_value}**。  
    请根据以下医疗问题信息，对指定选项 **{treatment_option_value}** 进行专业分析。
    
    ==============================
    【医疗问题信息】
    - 问题描述: {question}
    - 相关背景: {meta_info}
    
    ==============================
    【角色信息】
    - 当前角色: {role_value}
    - 角色定义: {role_description}
    - 角色当前对关注的问题选项: {json.dumps([option.value for option in question_options], ensure_ascii=False, indent=2)}
    - 角色当前关注重点: {json.dumps(opinion.concerns, ensure_ascii=False, indent=2)}
    
    ==============================
    【问题选项列表】
    {[f"{option.value}: {question_state.options[option.name]}" for option in question_options]}  
    （如示例："A: 苯溴马隆", "B: 别嘌呤醇"...）
    
    ==============================
    【任务要求】
    请从 **{role_value}** 专业角度对选项 **{treatment_option_value}** 适合度评分进行分析：
    1. 为每个选项进行独立的适合度评分，范围在-1到1之间（不包含-1和1）：
    - 若题目要求“选择不正确的选项”：
        某个选项越符合“不正确”的特征（即该选项本身是错误的），评分越高（接近1）；
        某个选项越不符合“不正确”的特征（即该选项本身是正确的），评分越低（接近-1）。
    - 若题目要求“选择正确的选项”：
        某个选项越正确（符合医学事实），评分越高（接近1）；
        某个选项越错误，评分越低（接近-1）。
    2. 如果选项适合度评分 >0.6，分析支持该选项的原因；如果选项适合度评分 < 0.3，分析反对该选项的原因；  
    3. 指出可能的风险与注意事项；  
    4. 分析该选项与正确答案的匹配度。  
    
    ==============================
    【输出要求】
    - 使用专业但易懂的语言；  
    - 控制在 200 字以内；  
    - 仅返回文本内容，不使用 JSON 或额外标记；  
    - 回答需可直接用于 MDT 多智能体讨论系统
build_dialogue_response_prompt:
  prompt: |
    你是一名医疗多学科团队（MDT, Multidisciplinary Team）的成员，
    当前身份为 **{role_value}**。
    你的任务是在团队会议中，基于医学问题与讨论历史，给出自然、专业且有角色特色的回应。

    prompt: |
    ==============================
    【医疗问题信息】
    - 问题描述：{question}
    - 相关背景：{meta_info}
    
    ==============================
    【讨论选项】
    - 当前讨论的问题选项：{treatment_option}
    
    ==============================
    【讨论背景】
    - 历史讨论内容：{history_context}
    - 当前立场信息：{stance_info}
    
    ==============================
    【任务要求】
    请从 **{role_value}** 的专业角度出发，对该问题生成自然、连贯的回应：
    1. 每个选项的适合度评分范围为 -1 ~ 1（不含 -1 和 1）：
       - 若题目要求“选择不正确的选项”：
         选项越符合“不正确”特征（即错误的）→ 评分越高（接近 1）；
         越不符合（即正确的）→ 评分越低（接近 -1）。
       - 若题目要求“选择正确的选项”：
         越正确（符合医学事实）→ 评分越高；
         越错误 → 评分越低。
    2. 回应要自然流畅，避免模板化；
    3. 体现角色特色与专业判断；
    4. 考虑先前讨论（{history_context}），保持语义连贯；
    5. 表达应简洁、真诚、有说服力；
    6. 若意见不同，应礼貌但坚定；
    7. 长度建议 2~3 句话。
    
    ==============================
    【输出要求】
    - 仅返回文字回应，不得包含 JSON、额外说明或格式符；
    - 输出应可直接作为多智能体对话系统中 **{role_value}** 的自然回应。

build_update_agent_opinions_reasoning:
  system: |
    你是多学科会诊（MDT, Multidisciplinary Team）的一名成员，
    当前身份为 **{role_value}**。
    你的任务是从本专业角度出发，对当前医疗问题进行再评估，并输出结构化结果。

  prompt: |
    ==============================
    【医疗问题信息】
    - 问题描述: {question}
    - 背景信息: {meta_info}
    - 问题选项列表：
      {options_list}
    
    ==============================
    【角色与历史信息】
    - 当前角色: {role_value}
    - 专业背景: {role_description}
    - 上轮推理: {previous_reasoning}
    - 上轮选项适合度评分: {previous_preferences}
    - 关注重点: {previous_concerns}
    
    ==============================
    【多学科对话记录】
    以下是团队本轮的讨论过程，包含来自其他医生（如肿瘤科、影像科、外科、营养科、心理科等）的观点：
    {dialogue_text}
    
    ==============================
    【当前任务】
    请你作为 **{role_value}** 专业医生，根据当前医疗问题和团队讨论，综合考虑：
    1. 医疗问题与背景；
    2. 本角色历史观点；
    3. 其他学科成员的最新发言与分歧；
    4. 各问题选项的风险、获益与正确答案的适合度。
    
    重新评估每个问题选项的适合度和置信度以及推理内容：
    1. 为每个选项进行独立的适合度评分，范围在 -1 到 1 之间（不包含 -1 和 1）：
       - 若题目要求“选择不正确的选项”：
         某个选项越符合“不正确”的特征（即该选项本身是错误的），评分越高（接近 1）；
         某个选项越不符合（即该选项本身是正确的），评分越低（接近 -1）。
       - 若题目要求“选择正确的选项”：
         某个选项越正确（符合医学事实），评分越高（接近 1）；
         某个选项越错误，评分越低（接近 -1）。
    2. 指出可能的风险与注意事项；
    3. 分析该选项与正确答案的适合度；
    4. 指出每个选项可能的风险与注意事项；
    5. 分析各选项与正确治疗方案的匹配度；
    6. 输出需为严格的 JSON 格式。
    
    ==============================
    【输出要求】
    请严格输出符合以下格式的 JSON（不要输出任何额外文字）：
    
    1. `role`: 当前角色名；
    2. `treatment_preferences`: 字典类型，键为选项索引（如 "A"、"B"），值为选项的适合度评分（-1 ~ 1）；
    3. `reasoning`: 字符串（≤80字），概括主要打分逻辑；
    4. `confidence`: 0~1 之间的浮点数，表示判断的可信度；
    5. `concerns`: 列表，包含 2~3 条（每条 ≤20字）关键担忧。
    
    ==============================
    【输出示例】
    {{
        "role": "{role_value}",
        "treatment_preferences": {{"A": 0.7, "B": 0.3, "C": -0.5}},
        "reasoning": "结合问题描述与选项风险，A方案最优且风险可控",
        "confidence": 0.85,
        "concerns": ["药物不良反应", "肝肾功能负担", "依从性较低"]
    }}
    
    ==============================
    【附加注意】
    - 请不要在 JSON 之外输出任何文字、说明或解释；
    - treatment_preferences 的键必须是选项索引（如 "A"、"B"）；
    - 所有选项索引（"A"、"B"、"C" 等）必须完整出现在 `treatment_preferences` 中；
    - 若团队存在意见分歧，请在 reasoning 中体现平衡考虑；
    - 生成结果需可直接适配 RoleOpinion 类。